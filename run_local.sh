#!/bin/bash
# Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ ÐºÐ¾Ð½Ñ‚ÑƒÑ€: Ð·Ð°Ð¿ÑƒÑÐº ÑÐµÑ€Ð²Ð¸ÑÐ° Ð¸ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ Ð² Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ðµ.
# Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ: ./run_local.sh

set -e
cd "$(dirname "$0")"

echo "ðŸ“¦ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹..."
if ! python3 -c "import fastapi" 2>/dev/null; then
  echo "Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÑŽ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸..."
  pip install -q -r requirements.txt
fi

echo "ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº ÑÐµÑ€Ð²Ð¸ÑÐ° Ð½Ð° http://127.0.0.1:8000"
echo "   ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°: Ctrl+C"
echo ""

# ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€ Ñ‡ÐµÑ€ÐµÐ· 2 ÑÐµÐºÑƒÐ½Ð´Ñ‹ (Ð´Ð°Ñ‚ÑŒ ÑÐµÑ€Ð²ÐµÑ€Ñƒ Ð¿Ð¾Ð´Ð½ÑÑ‚ÑŒÑÑ)
(sleep 2 && open "http://127.0.0.1:8000" 2>/dev/null || true) &

python3 -m uvicorn app.main:app --reload --host 127.0.0.1 --port 8000
